{\rtf1\ansi\ansicpg950\cocoartf2867
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red77\green80\blue85;\red246\green247\blue249;\red46\green49\blue51;
\red21\green98\blue39;\red20\green67\blue174;\red186\green6\blue115;\red162\green0\blue16;\red24\green25\blue27;
\red18\green115\blue126;\red97\green3\blue173;}
{\*\expandedcolortbl;;\cssrgb\c37255\c38824\c40784;\cssrgb\c97255\c97647\c98039;\cssrgb\c23529\c25098\c26275;
\cssrgb\c7451\c45098\c20000;\cssrgb\c9412\c35294\c73725;\cssrgb\c78824\c15294\c52549;\cssrgb\c70196\c7843\c7059;\cssrgb\c12549\c12941\c14118;
\cssrgb\c3529\c52157\c56863;\cssrgb\c46275\c15294\c73333;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs26 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // ========== Code.gs ======\cf4 \cb1 \strokec4 \
\cf2 \cb3 \strokec2 // =========================\cf4 \cb1 \strokec4 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u21508 \u20489 \u21029 \u23565 \u25033 \u30340  Google Sheet ID */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4  = \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf8 \strokec8 'TAO1'\cf4 \strokec4 : \cf8 \strokec8 '1_bhGQdx0YH7lsqPFEq5___6_Nwq_gbelJmIHv0bmaIE'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO3'\cf4 \strokec4 : \cf8 \strokec8 '1cffI2jIVZA1uSiAyaLLXXgPzDByhy87xznaN85O7wEE'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO4'\cf4 \strokec4 : \cf8 \strokec8 '1tVxQbV0298fn2OXWAF0UqZa7FLbypsatciatxs4YVTU'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO5'\cf4 \strokec4 : \cf8 \strokec8 '1jzVXC6gt36hJtlUHoxtTzZLMNj4EtTsd4k8eNB1bdiA'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO6'\cf4 \strokec4 : \cf8 \strokec8 '1wwPLSLjl2abfM_OMdTNI9PoiPKo3waCV_y0wmx2DxAE'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO7'\cf4 \strokec4 : \cf8 \strokec8 '16nGCqRO8DYDm0PbXFbdt-fiEFZCXxXjlOWjKU67p4LY'\cf4 \strokec4 ,\cb1 \
\cb3   \cf8 \strokec8 'TAO10'\cf4 \strokec4 : \cf8 \strokec8 '1y0w49xdFlHvcVtgtG8fq6zdrF26y8j7HMFh5ujzUyR4'\cf4 \cb1 \strokec4 \
\cb3 \};\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u38928 \u35373 \u20489 \u21029 \u65288 \u30331 \u20837 \u33287 \u38928 \u35373 \u30059 \u38754 \u65289  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 DEFAULT_WAREHOUSE_KEY\cf4 \strokec4  = \cf8 \strokec8 'TAO1'\cf4 \strokec4 ;\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u22266 \u23450 \u35712 \u21462 \u19968 \u20221 \u34920 \u65288 TAO1\u65292 \u21487 \u33258 \u34892 \u26356 \u25913 \u36889 \u19968 \u20491  ID)\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u30446 \u21069 \u29992 \u26044 \u30331 \u20837 \u39511 \u35657 \u33287 \u38928 \u35373 \u20489 \u21029 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 SPREADSHEET_ID\cf4 \strokec4  = \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf7 \strokec7 DEFAULT_WAREHOUSE_KEY\cf4 \strokec4 ];\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u19981 \u30070 \u20316 \u20998 \u38913 \u36984 \u38917 \u30340 \u20998 \u38913 \u65288 \u30331 \u20837 \u29992 \u12289 \u35722 \u21205 \u32000 \u37636 \u31561 \u65289  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 EXCLUDED_SHEETS\cf4 \strokec4  = [\cf8 \strokec8 '\uc0\u29983 \u26085 \u31649 \u29702 '\cf4 \strokec4 , \cf8 \strokec8 '\uc0\u35722 \u21205 \u35352 \u37636 '\cf4 \strokec4 ];\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u30331 \u20837 \u39511 \u35657 \u29992 \u20998 \u38913 \u21517 \u31281 \u65288 \u22312  SPREADSHEET_ID \u35041 \u65289  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 LOGIN_SHEET_NAME\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u29983 \u26085 \u31649 \u29702 '\cf4 \strokec4 ;\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** MASTER INDEX \uc0\u35430 \u31639 \u34920 \u65306 \u29992 \u20358 \u20808 \u26597 \u22995 \u21517 /\u29983 \u26085 /\u20489 \u21029 \u65288 A=\u22995 \u21517 ,B=\u29983 \u26085 ,C=\u20489 \u21029 \u65289  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 MASTER_INDEX_SPREADSHEET_ID\cf4 \strokec4  = \cf8 \strokec8 '12ce9KH2Zjs4mQ90d0yxvwww4gnjpOuEKg7eFWTec0oQ'\cf4 \strokec4 ;\cb1 \
\cf6 \cb3 \strokec6 const\cf4 \strokec4  \cf7 \strokec7 MASTER_INDEX_SHEET_NAME\cf4 \strokec4  = \cf8 \strokec8 'index'\cf4 \strokec4 ;\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u20381 \u20659 \u20837 \u20489 \u21029  key (\u22914  "TAO3") \u21462 \u24471 \u23526 \u38555 \u35430 \u31639 \u34920  ID\u65292 \u33509 \u28961 \u21063 \u25913 \u29992 \u38928 \u35373  TAO1 */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 resolveWarehouse_\cf4 \strokec4 (\cf9 \strokec9 wh\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 key\cf4 \strokec4  = \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 wh\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 key\cf4 \strokec4 ]) \cf9 \strokec9 key\cf4 \strokec4  = \cf7 \strokec7 DEFAULT_WAREHOUSE_KEY\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 key\cf4 \strokec4 : \cf9 \strokec9 key\cf4 \strokec4 , \cf9 \strokec9 id\cf4 \strokec4 : \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 key\cf4 \strokec4 ] \};\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 fastPayloadForName_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 , \cf9 \strokec9 frozenLeft\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 maxCheck\cf4 \strokec4  = \cf7 \strokec7 Math\cf4 \strokec4 .\cf9 \strokec9 min\cf4 \strokec4 (\cf9 \strokec9 lastRow\cf4 \strokec4 , \cf10 \strokec10 3\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headVals\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 maxCheck\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 headVals\cf4 \strokec4  || !\cf9 \strokec9 headVals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 null\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headerRowIndex\cf4 \strokec4  = \cf9 \strokec9 detectHeaderRowIndex_\cf4 \strokec4 (\cf9 \strokec9 headVals\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headers\cf4 \strokec4  = \cf9 \strokec9 headVals\cf4 \strokec4 [\cf9 \strokec9 headerRowIndex\cf4 \strokec4 ] || [];\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headersISO\cf4 \strokec4  = \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 map\cf4 \strokec4 (\cf9 \strokec9 guessISOFromHeaderText_\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCols\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 headersISO\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 headersISO\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ]) \cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\cf9 \strokec9 i\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dataStartRow\cf4 \strokec4  = \cf9 \strokec9 headerRowIndex\cf4 \strokec4  + \cf10 \strokec10 2\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 dataStartRow\cf4 \strokec4  > \cf9 \strokec9 lastRow\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3       \cf9 \strokec9 headers\cf4 \strokec4 : \cf9 \strokec9 headers\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 headersISO\cf4 \strokec4 : \cf9 \strokec9 headersISO\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 headersTop\cf4 \strokec4 : \cf9 \strokec9 headerRowIndex\cf4 \strokec4  > \cf10 \strokec10 0\cf4 \strokec4  ? \cf9 \strokec9 headVals\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] : [],\cb1 \
\cb3       \cf9 \strokec9 rows\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 dateCols\cf4 \strokec4 : \cf9 \strokec9 dateCols\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 frozenLeft\cf4 \strokec4 : \cf9 \strokec9 frozenLeft\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 engine\cf4 \strokec4 : \cf8 \strokec8 'fast'\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 counts\cf4 \strokec4 : \{ \cf9 \strokec9 rows\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 cols\cf4 \strokec4 : \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  \}\cb1 \
\cb3     \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 null\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameVals\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf9 \strokec9 dataStartRow\cf4 \strokec4 , \cf9 \strokec9 nameCol\cf4 \strokec4  + \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4  - (\cf9 \strokec9 dataStartRow\cf4 \strokec4  - \cf10 \strokec10 1\cf4 \strokec4 ), \cf10 \strokec10 1\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 target\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 matchRows\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 r\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4  < \cf9 \strokec9 nameVals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cell\cf4 \strokec4  = \cf9 \strokec9 nameVals\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ] && \cf9 \strokec9 nameVals\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ][\cf10 \strokec10 0\cf4 \strokec4 ] != \cf6 \strokec6 null\cf4 \strokec4  ? \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 nameVals\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ][\cf10 \strokec10 0\cf4 \strokec4 ]) : \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 cell\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 cell\cf4 \strokec4 ) === \cf9 \strokec9 target\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf9 \strokec9 matchRows\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\cf9 \strokec9 dataStartRow\cf4 \strokec4  + \cf9 \strokec9 r\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rows\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 matchRows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 minR\cf4 \strokec4  = \cf9 \strokec9 matchRows\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 maxR\cf4 \strokec4  = \cf9 \strokec9 matchRows\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ];\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf6 \strokec6 set\cf4 \strokec4  = \{\};\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 k\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 k\cf4 \strokec4  < \cf9 \strokec9 matchRows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 k\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rr\cf4 \strokec4  = \cf9 \strokec9 matchRows\cf4 \strokec4 [\cf9 \strokec9 k\cf4 \strokec4 ];\cb1 \
\cb3       \cf6 \strokec6 set\cf4 \strokec4 [\cf9 \strokec9 rr\cf4 \strokec4 ] = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 rr\cf4 \strokec4  < \cf9 \strokec9 minR\cf4 \strokec4 ) \cf9 \strokec9 minR\cf4 \strokec4  = \cf9 \strokec9 rr\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 rr\cf4 \strokec4  > \cf9 \strokec9 maxR\cf4 \strokec4 ) \cf9 \strokec9 maxR\cf4 \strokec4  = \cf9 \strokec9 rr\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rng\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf9 \strokec9 minR\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 maxR\cf4 \strokec4  - \cf9 \strokec9 minR\cf4 \strokec4  + \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 vals\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bgs\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getBackgrounds\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 fcs\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getFontColors\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 off\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 off\cf4 \strokec4  < \cf9 \strokec9 vals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 off\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 absRow\cf4 \strokec4  = \cf9 \strokec9 minR\cf4 \strokec4  + \cf9 \strokec9 off\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf6 \strokec6 set\cf4 \strokec4 [\cf9 \strokec9 absRow\cf4 \strokec4 ]) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\{\cb1 \
\cb3         \cf9 \strokec9 v\cf4 \strokec4 : \cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 off\cf4 \strokec4 ].\cf9 \strokec9 map\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 x\cf4 \strokec4 ) \{ \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 x\cf4 \strokec4  == \cf6 \strokec6 null\cf4 \strokec4  ? \cf8 \strokec8 ''\cf4 \strokec4  : \cf9 \strokec9 x\cf4 \strokec4 ); \}),\cb1 \
\cb3         \cf9 \strokec9 bg\cf4 \strokec4 : \cf9 \strokec9 bgs\cf4 \strokec4 [\cf9 \strokec9 off\cf4 \strokec4 ].\cf9 \strokec9 slice\cf4 \strokec4 (),\cb1 \
\cb3         \cf9 \strokec9 fc\cf4 \strokec4 : \cf9 \strokec9 fcs\cf4 \strokec4 [\cf9 \strokec9 off\cf4 \strokec4 ].\cf9 \strokec9 slice\cf4 \strokec4 ()\cb1 \
\cb3       \});\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 payload\cf4 \strokec4  = \{\cb1 \
\cb3     \cf9 \strokec9 headers\cf4 \strokec4 : \cf9 \strokec9 headers\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 headersISO\cf4 \strokec4 : \cf9 \strokec9 headersISO\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 headersTop\cf4 \strokec4 : \cf9 \strokec9 headerRowIndex\cf4 \strokec4  > \cf10 \strokec10 0\cf4 \strokec4  ? \cf9 \strokec9 headVals\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] : [],\cb1 \
\cb3     \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 rows\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 dateCols\cf4 \strokec4 : \cf9 \strokec9 dateCols\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 frozenLeft\cf4 \strokec4 : \cf9 \strokec9 frozenLeft\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 engine\cf4 \strokec4 : \cf8 \strokec8 'fast'\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 counts\cf4 \strokec4 : \{ \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 , \cf9 \strokec9 cols\cf4 \strokec4 : \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  \}\cb1 \
\cb3   \};\cb1 \
\
\cb3   \cf9 \strokec9 attachAttendanceFlagsForRows_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 payload\cf4 \strokec4 , \cf9 \strokec9 rows\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 payload\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u32178 \u38913 \u20837 \u21475 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u38928 \u35373 \u22238 \u20659  index.html\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * mode=api \uc0\u26178 \u22238 \u20659 \u25351 \u23450 \u20998 \u38913 \u65291 \u25351 \u23450 \u22995 \u21517 \u30340 \u36039 \u26009 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * mode=getSheets \uc0\u26178 \u22238 \u20659 \u35442 \u20489 \u21029 \u30340 \u21487 \u36984 \u20998 \u38913 \u28165 \u21934 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * mode=getAllPeopleCount \uc0\u26178 \u22238 \u20659 \u25152 \u26377 \u20489 \u21029 \u20154 \u25976 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u21487 \u21152  wh=TAO3 / TAO4 ... \u20999 \u25563 \u20489 \u21029 \u65288 \u30446 \u21069 \u21482 \u32102 \u31649 \u29702 \u32773 \u21069 \u31471 \u20351 \u29992 \u65289 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 doGet\cf4 \strokec4 (\cf9 \strokec9 e\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 whParam\cf4 \strokec4  = \cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 wh\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 resolved\cf4 \strokec4  = \cf9 \strokec9 resolveWarehouse_\cf4 \strokec4 (\cf9 \strokec9 whParam\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 warehouseKey\cf4 \strokec4  = \cf9 \strokec9 resolved\cf4 \strokec4 .\cf9 \strokec9 key\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ssid\cf4 \strokec4  = \cf9 \strokec9 resolved\cf4 \strokec4 .\cf9 \strokec9 id\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u9989  \u21482 \u22238 \u20659 \u25351 \u23450 \u20489 \u21029 \u30340 \u35430 \u31639 \u34920  ID\u65288 \u32102 \u21069 \u31471 \u12300 \u38283 \u21855 \u21508 \u20489 \u35430 \u31639 \u34920 \u12301 \u29992 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf2 \strokec2 // \uc0\u27880 \u24847 \u65306 \u27492 \u27169 \u24335 \u19981 \u20570 \u38928 \u35373 \u20489 \u21029 \u22238 \u36864 \u65307 \u33509 \u20489 \u21029 \u19981 \u23384 \u22312 \u23601 \u22238 \u20659 \u37679 \u35492 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 mode\cf4 \strokec4  === \cf8 \strokec8 'getWarehouseId'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rawKey\cf4 \strokec4  = \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 whParam\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 rawKey\cf4 \strokec4  || !\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 rawKey\cf4 \strokec4 ]) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cb1 \
\cb3         \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 error\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u20489 \u21029 \u35430 \u31639 \u34920  ID\u65306 '\cf4 \strokec4  + \cf9 \strokec9 rawKey\cf4 \strokec4  \})\cb1 \
\cb3       ).\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cb1 \
\cb3       \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 true\cf4 \strokec4 , \cf9 \strokec9 warehouse\cf4 \strokec4 : \cf9 \strokec9 rawKey\cf4 \strokec4 , \cf9 \strokec9 spreadsheetId\cf4 \strokec4 : \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 rawKey\cf4 \strokec4 ] \})\cb1 \
\cb3     ).\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u22238 \u20659 \u25152 \u26377 \u20489 \u21029 \u20154 \u25976 \u65288 \u32102 \u21069 \u31471  KPI \u29992 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 mode\cf4 \strokec4  === \cf8 \strokec8 'getAllPeopleCount'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 countData\cf4 \strokec4  = \cf9 \strokec9 getAllPeopleCount_\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cb1 \
\cb3       \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\{\cb1 \
\cb3         \cf9 \strokec9 totalPeople\cf4 \strokec4 : \cf9 \strokec9 countData\cf4 \strokec4 .\cf9 \strokec9 total\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 details\cf4 \strokec4 : \cf9 \strokec9 countData\cf4 \strokec4 .\cf9 \strokec9 details\cf4 \cb1 \strokec4 \
\cb3       \})\cb1 \
\cb3     ).\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u21482 \u22238 \u20659 \u25351 \u23450 \u20489 \u21029 \u30340 \u20998 \u38913 \u28165 \u21934 \u65288 \u32102 \u21069 \u31471 \u31649 \u29702 \u32773 \u20999 \u25563 \u20489 \u21029 \u29992 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 mode\cf4 \strokec4  === \cf8 \strokec8 'getSheets'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 namesForApi\cf4 \strokec4  = \cf9 \strokec9 getSheetNames_\cf4 \strokec4 (\cf9 \strokec9 ssid\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cb1 \
\cb3       \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\{\cb1 \
\cb3         \cf9 \strokec9 warehouse\cf4 \strokec4 : \cf9 \strokec9 warehouseKey\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 sheetNames\cf4 \strokec4 : \cf9 \strokec9 namesForApi\cf4 \cb1 \strokec4 \
\cb3       \})\cb1 \
\cb3     ).\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u9989  \u30331 \u20837 \u39511 \u35657 \u65288 \u32102 \u21069 \u31471  LoginPage \u29992 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 mode\cf4 \strokec4  === \cf8 \strokec8 'verifyLogin'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 name\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bd\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 birthday\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 res\cf4 \strokec4  = \cf9 \strokec9 verifyLogin\cf4 \strokec4 (\cf9 \strokec9 nm\cf4 \strokec4 , \cf9 \strokec9 bd\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\cf9 \strokec9 res\cf4 \strokec4 ))\cb1 \
\cb3       .\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetNames\cf4 \strokec4  = \cf9 \strokec9 getSheetNames_\cf4 \strokec4 (\cf9 \strokec9 ssid\cf4 \strokec4 );\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u38928 \u35373 \u20998 \u38913 \u65306 \u20778 \u20808 \u12300 \u20986 \u21220 \u35352 \u37636 \u12301 \u65292 \u20877 \u20358 \u12300 \u29677 \u34920 \u12301 \u65292 \u25214 \u19981 \u21040 \u23601 \u29992 \u31532 \u19968 \u20491 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 prefer\cf4 \strokec4  = \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNames\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u20986 \u21220 \u35352 \u37636 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf9 \strokec9 prefer\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u20986 \u21220 \u35352 \u37636 '\cf4 \strokec4 ;\cb1 \
\cb3   \} \cf6 \strokec6 else\cf4 \strokec4  \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNames\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf9 \strokec9 prefer\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ;\cb1 \
\cb3   \} \cf6 \strokec6 else\cf4 \strokec4  \{\cb1 \
\cb3     \cf9 \strokec9 prefer\cf4 \strokec4  = \cf9 \strokec9 sheetNames\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rawSheet\cf4 \strokec4  = (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 sheet\cf4 \strokec4 ) || \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 pick\cf4 \strokec4  = \cf9 \strokec9 tryDecodeOnce_\cf4 \strokec4 (\cf9 \strokec9 rawSheet\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetName\cf4 \strokec4  = \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 wantKey\cf4 \strokec4  = \cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 pick\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 wantKey\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 si\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 si\cf4 \strokec4  < \cf9 \strokec9 sheetNames\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 si\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 sheetNames\cf4 \strokec4 [\cf9 \strokec9 si\cf4 \strokec4 ]) === \cf9 \strokec9 wantKey\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 sheetName\cf4 \strokec4  = \cf9 \strokec9 sheetNames\cf4 \strokec4 [\cf9 \strokec9 si\cf4 \strokec4 ];\cb1 \
\cb3         \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sheetName\cf4 \strokec4 ) \cf9 \strokec9 sheetName\cf4 \strokec4  = \cf9 \strokec9 prefer\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u36039 \u26009  API\u65306 \u21482 \u22238 \u20659 \u25351 \u23450 \u22995 \u21517 \u30340 \u21015 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 mode\cf4 \strokec4  === \cf8 \strokec8 'api'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 loginName\cf4 \strokec4  = (\cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 name\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 targetWarehouseKey\cf4 \strokec4  = \cf9 \strokec9 warehouseKey\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 targetSsid\cf4 \strokec4  = \cf9 \strokec9 ssid\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 loginName\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ()) \{\cb1 \
\cb3         \cf9 \strokec9 targetWarehouseKey\cf4 \strokec4  = \cf9 \strokec9 lookupWarehouseKeyByNameFromIndex_\cf4 \strokec4 (\cf9 \strokec9 loginName\cf4 \strokec4 );\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (!\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 targetWarehouseKey\cf4 \strokec4 ]) \{\cb1 \
\cb3           \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 'INDEX \uc0\u20489 \u21029 \u28961 \u25928 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 targetWarehouseKey\cf4 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3         \cf9 \strokec9 targetSsid\cf4 \strokec4  = \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 targetWarehouseKey\cf4 \strokec4 ];\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetNamesForApi\cf4 \strokec4  = \cf9 \strokec9 getSheetNames_\cf4 \strokec4 (\cf9 \strokec9 targetSsid\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 preferForApi\cf4 \strokec4  = \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u20986 \u21220 \u35352 \u37636 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 preferForApi\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u20986 \u21220 \u35352 \u37636 '\cf4 \strokec4 ;\cb1 \
\cb3       \} \cf6 \strokec6 else\cf4 \strokec4  \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 preferForApi\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ;\cb1 \
\cb3       \} \cf6 \strokec6 else\cf4 \strokec4  \{\cb1 \
\cb3         \cf9 \strokec9 preferForApi\cf4 \strokec4  = \cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rawSheetForApi\cf4 \strokec4  = (\cf9 \strokec9 e\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4  && \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 parameter\cf4 \strokec4 .\cf9 \strokec9 sheet\cf4 \strokec4 ) || \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 pickForApi\cf4 \strokec4  = \cf9 \strokec9 tryDecodeOnce_\cf4 \strokec4 (\cf9 \strokec9 rawSheetForApi\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetNameForApi\cf4 \strokec4  = \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 wantKeyApi\cf4 \strokec4  = \cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 pickForApi\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 wantKeyApi\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sj\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 sj\cf4 \strokec4  < \cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 sj\cf4 \strokec4 ++) \{\cb1 \
\cb3           \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 [\cf9 \strokec9 sj\cf4 \strokec4 ]) === \cf9 \strokec9 wantKeyApi\cf4 \strokec4 ) \{\cb1 \
\cb3             \cf9 \strokec9 sheetNameForApi\cf4 \strokec4  = \cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 [\cf9 \strokec9 sj\cf4 \strokec4 ];\cb1 \
\cb3             \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3           \}\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sheetNameForApi\cf4 \strokec4 ) \cf9 \strokec9 sheetNameForApi\cf4 \strokec4  = \cf9 \strokec9 preferForApi\cf4 \strokec4 ;\cb1 \
\
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 payload\cf4 \strokec4  = \cf9 \strokec9 getGridPayloadForName_\cf4 \strokec4 (\cf9 \strokec9 sheetNameForApi\cf4 \strokec4 , \cf9 \strokec9 targetSsid\cf4 \strokec4 , \cf9 \strokec9 loginName\cf4 \strokec4 );\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 requestedSheetRaw\cf4 \strokec4  = \cf9 \strokec9 rawSheetForApi\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 requestedSheetDecoded\cf4 \strokec4  = \cf9 \strokec9 pickForApi\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 sheetNameUsed\cf4 \strokec4  = \cf9 \strokec9 sheetNameForApi\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 availableSheets\cf4 \strokec4  = \cf9 \strokec9 sheetNamesForApi\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 warehouse\cf4 \strokec4  = \cf9 \strokec9 targetWarehouseKey\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 payload\cf4 \strokec4 .\cf9 \strokec9 spreadsheetId\cf4 \strokec4  = \cf9 \strokec9 targetSsid\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\cf9 \strokec9 payload\cf4 \strokec4 ))\cb1 \
\cb3         .\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3     \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 err\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 ContentService\cf4 \strokec4 .\cf9 \strokec9 createTextOutput\cf4 \strokec4 (\cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\{ \cf9 \strokec9 error\cf4 \strokec4 : \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 err\cf4 \strokec4 ) \}))\cb1 \
\cb3         .\cf9 \strokec9 setMimeType\cf4 \strokec4 (\cf7 \strokec7 ContentService\cf4 \strokec4 .\cf7 \strokec7 MimeType\cf4 \strokec4 .\cf7 \strokec7 JSON\cf4 \strokec4 );\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u19968 \u33324 \u28687 \u35261 \u65306 \u22238 \u20659 \u30059 \u38754 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 t\cf4 \strokec4  = \cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf9 \strokec9 createTemplateFromFile\cf4 \strokec4 (\cf8 \strokec8 'index'\cf4 \strokec4 );\cb1 \
\cb3   \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 sheetNames\cf4 \strokec4  = \cf9 \strokec9 sheetNames\cf4 \strokec4 ;\cb1 \
\cb3   \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 sheetName\cf4 \strokec4  = \cf9 \strokec9 sheetName\cf4 \strokec4 ;\cb1 \
\cb3   \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 whKey\cf4 \strokec4  = \cf9 \strokec9 warehouseKey\cf4 \strokec4 ;\cb1 \
\cb3   \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 whKeys\cf4 \strokec4  = \cf7 \strokec7 Object\cf4 \strokec4 .\cf9 \strokec9 keys\cf4 \strokec4 (\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 ); \cf2 \strokec2 // \uc0\u20363 \u22914  ["TAO1","TAO3",...]\cf4 \cb1 \strokec4 \
\cb3   \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 whIds\cf4 \strokec4  = \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 ; \cf2 \strokec2 // \uc0\u9989  \u32102 \u21069 \u31471 \u12300 \u38283 \u21855 \u21508 \u20489 \u35430 \u31639 \u34920 \u12301 \u19979 \u25289 \u36984 \u21934 \u29992 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 t\cf4 \strokec4 .\cf9 \strokec9 evaluate\cf4 \strokec4 ()\cb1 \
\cb3     .\cf9 \strokec9 setTitle\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u23439 \u30427 \u37239 \u28558 \u34920  - \u30331 \u20837 '\cf4 \strokec4 )\cb1 \
\cb3     .\cf9 \strokec9 setXFrameOptionsMode\cf4 \strokec4 (\cf7 \strokec7 HtmlService\cf4 \strokec4 .\cf7 \strokec7 XFrameOptionsMode\cf4 \strokec4 .\cf7 \strokec7 ALLOWALL\cf4 \strokec4 );\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 norm_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 norm_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ).\cf9 \strokec9 replace\cf4 \strokec4 (\cf11 \strokec11 /[\\s\\u00A0\\u3000\\u200B]+/\cf6 \strokec6 g\cf4 \strokec4 , \cf8 \strokec8 ''\cf4 \strokec4 );\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 norm_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ).\cf9 \strokec9 replace\cf4 \strokec4 (\cf11 \strokec11 /[\\/\\-\\.\\s]/\cf6 \strokec6 g\cf4 \strokec4 , \cf8 \strokec8 ''\cf4 \strokec4 );\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 norm_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ).\cf9 \strokec9 replace\cf4 \strokec4 (\cf11 \strokec11 /\\s+/\cf6 \strokec6 g\cf4 \strokec4 , \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 toUpperCase\cf4 \strokec4 ();\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 )\cb1 \
\cb3     .\cf9 \strokec9 replace\cf4 \strokec4 (\cf11 \strokec11 /[\\u00A0\\u3000]/\cf6 \strokec6 g\cf4 \strokec4 , \cf8 \strokec8 ' '\cf4 \strokec4 )\cb1 \
\cb3     .\cf9 \strokec9 replace\cf4 \strokec4 (\cf11 \strokec11 /\\s+/\cf6 \strokec6 g\cf4 \strokec4 , \cf8 \strokec8 ' '\cf4 \strokec4 )\cb1 \
\cb3     .\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 getSheetNames_\cf4 \strokec4 (\cf9 \strokec9 spreadsheetId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ss\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf9 \strokec9 spreadsheetId\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 all\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheets\cf4 \strokec4 ().\cf9 \strokec9 map\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 s\cf4 \strokec4 ) \{ \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 getName\cf4 \strokec4 (); \});\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 all\cf4 \strokec4 .\cf9 \strokec9 filter\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 n\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nk\cf4 \strokec4  = \cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf9 \strokec9 n\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf7 \strokec7 EXCLUDED_SHEETS\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 normSheetKey_\cf4 \strokec4 (\cf7 \strokec7 EXCLUDED_SHEETS\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ]) === \cf9 \strokec9 nk\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 false\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3   \});\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 detectNameColByData_\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 rows\cf4 \strokec4  || !\cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 target\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 target\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 maxRows\cf4 \strokec4  = \cf7 \strokec7 Math\cf4 \strokec4 .\cf9 \strokec9 min\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 , \cf10 \strokec10 300\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 maxCols\cf4 \strokec4  = (\cf9 \strokec9 rows\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] && \cf9 \strokec9 rows\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 ) ? \cf9 \strokec9 rows\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  : \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 maxCols\cf4 \strokec4  <= \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 c\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 c\cf4 \strokec4  < \cf9 \strokec9 maxCols\cf4 \strokec4 ; \cf9 \strokec9 c\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 r\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4  < \cf9 \strokec9 maxRows\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 v\cf4 \strokec4  = \cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ] && \cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4  ? \cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 c\cf4 \strokec4 ] : \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 v\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 normName_\cf4 \strokec4 (\cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 v\cf4 \strokec4 )) === \cf9 \strokec9 target\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 c\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 getSheetByNameCI_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 exact\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheetByName\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 exact\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 exact\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 want\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ().\cf9 \strokec9 toLowerCase\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 want\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 null\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheets\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheets\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 sheets\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 n\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 sheets\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ].\cf9 \strokec9 getName\cf4 \strokec4 () || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ().\cf9 \strokec9 toLowerCase\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 n\cf4 \strokec4  === \cf9 \strokec9 want\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 sheets\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ];\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf6 \strokec6 null\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 lookupWarehouseKeyByNameFromIndex_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 nm\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cache\cf4 \strokec4  = \cf7 \strokec7 CacheService\cf4 \strokec4 .\cf9 \strokec9 getScriptCache\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cacheKey\cf4 \strokec4  = \cf8 \strokec8 'idxWh:'\cf4 \strokec4  + \cf9 \strokec9 nm\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cached\cf4 \strokec4  = \cf9 \strokec9 cache\cf4 \strokec4 .\cf6 \strokec6 get\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cached\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 cached\cf4 \strokec4 );\cb1 \
\cb3   \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxSs\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf7 \strokec7 MASTER_INDEX_SPREADSHEET_ID\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxSh\cf4 \strokec4  = \cf9 \strokec9 getSheetByNameCI_\cf4 \strokec4 (\cf9 \strokec9 idxSs\cf4 \strokec4 , \cf7 \strokec7 MASTER_INDEX_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 idxSh\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u25214 \u19981 \u21040  MASTER_INDEX \u20998 \u38913 \u65306 '\cf4 \strokec4  + \cf7 \strokec7 MASTER_INDEX_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxLast\cf4 \strokec4  = \cf9 \strokec9 idxSh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 idxLast\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 'MASTER_INDEX \uc0\u23578 \u28961 \u36039 \u26009 '\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxVals\cf4 \strokec4  = \cf9 \strokec9 idxSh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 2\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 idxLast\cf4 \strokec4  - \cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 3\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 whSet\cf4 \strokec4  = \{\};\cb1 \
\
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 idxVals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 n\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 idxVals\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ][\cf10 \strokec10 0\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 n\cf4 \strokec4  !== \cf9 \strokec9 nm\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 wh\cf4 \strokec4  = \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 idxVals\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ][\cf10 \strokec10 2\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 wh\cf4 \strokec4 ) \cf9 \strokec9 whSet\cf4 \strokec4 [\cf9 \strokec9 wh\cf4 \strokec4 ] = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 keys\cf4 \strokec4  = \cf7 \strokec7 Object\cf4 \strokec4 .\cf9 \strokec9 keys\cf4 \strokec4 (\cf9 \strokec9 whSet\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 keys\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  === \cf10 \strokec10 1\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 try\cf4 \strokec4  \{ \cf9 \strokec9 cache\cf4 \strokec4 .\cf9 \strokec9 put\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 , \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 keys\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ]), \cf10 \strokec10 600\cf4 \strokec4 ); \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 keys\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ];\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 keys\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  > \cf10 \strokec10 1\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 'INDEX \uc0\u21516 \u21517 \u22810 \u20489 \u65292 \u35531 \u25351 \u23450 \u20489 \u21029 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 nm\cf4 \strokec4  + \cf8 \strokec8 ' \uc0\u8594  '\cf4 \strokec4  + \cf9 \strokec9 keys\cf4 \strokec4 .\cf9 \strokec9 join\cf4 \strokec4 (\cf8 \strokec8 ','\cf4 \strokec4 ));\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 'INDEX \uc0\u25214 \u19981 \u21040 \u35442 \u22995 \u21517 \u30340 \u20489 \u21029 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 nm\cf4 \strokec4 );\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u30331 \u20837 \u39511 \u35657 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * name\uc0\u65306 \u22995 \u21517 \u65307 birthday\u65306 \u29983 \u26085 \u65288 \u25991 \u23383 \u27604 \u36611 \u65292 \u19981 \u38480 \u21046 \u20301 \u25976 \u65289 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u35215 \u21063 \u65306 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *  - \uc0\u31649 \u29702 \u32773 \u65306 \u22995 \u21517 =\u12300 \u37239 \u28558 \u12301 \u65286 \u29983 \u26085 =\u12300 0000\u12301 \u8594  \u30452 \u25509 \u36890 \u36942 \u65292 \u19981 \u30475 \u35430 \u31639 \u34920 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *  - \uc0\u19968 \u33324 \u20351 \u29992 \u32773 \u65306 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *      1) \uc0\u20808 \u26597  MASTER_INDEX/index\u65306 A=\u22995 \u21517 \u12289 B=\u29983 \u26085 \u12289 C=\u20489 \u21029  \u8594  \u22995 \u21517 +\u29983 \u26085 \u30456 \u31526 \u25165 \u21462 \u20489 \u21029 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *      2) \uc0\u20877 \u21435 \u35442 \u20489 \u35430 \u31639 \u34920 \u30340 \u12300 \u29983 \u26085 \u31649 \u29702 \u12301 \u20998 \u38913 \u20013 \u65292 A\u27396 =\u22995 \u21517  \u19988  B\u27396 =\u29983 \u26085  \u25165 \u36890 \u36942 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *      3) \uc0\u22238 \u20659  warehouseKey \u32102 \u21069 \u31471 \u37782 \u23450 \u20489 \u21029 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 verifyLogin\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 birthday\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf9 \strokec9 name\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf9 \strokec9 birthday\cf4 \strokec4  = \cf9 \strokec9 norm_\cf4 \strokec4 (\cf9 \strokec9 birthday\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 name\cf4 \strokec4  || !\cf9 \strokec9 birthday\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u35531 \u36664 \u20837 \u22995 \u21517 \u33287 \u29983 \u26085 '\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u31649 \u29702 \u32773 \u24115 \u34399 \u65306 \u19981 \u29992 \u39511 \u35657 \u20998 \u38913 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 name\cf4 \strokec4  === \cf8 \strokec8 '\uc0\u37239 \u28558 '\cf4 \strokec4  && \cf9 \strokec9 birthday\cf4 \strokec4  === \cf8 \strokec8 '0000'\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 true\cf4 \strokec4 , \cf9 \strokec9 isAdmin\cf4 \strokec4 : \cf6 \strokec6 true\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 : \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 warehouseKey\cf4 \strokec4 : \cf7 \strokec7 DEFAULT_WAREHOUSE_KEY\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // 1) MASTER_INDEX\uc0\u65306 A=\u22995 \u21517  B=\u29983 \u26085  C=\u20489 \u21029 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cache\cf4 \strokec4  = \cf7 \strokec7 CacheService\cf4 \strokec4 .\cf9 \strokec9 getScriptCache\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ck\cf4 \strokec4  = \cf8 \strokec8 'idxLogin:'\cf4 \strokec4  + \cf9 \strokec9 name\cf4 \strokec4  + \cf8 \strokec8 ':'\cf4 \strokec4  + \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 birthday\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cachedWh\cf4 \strokec4  = \cf9 \strokec9 cache\cf4 \strokec4 .\cf6 \strokec6 get\cf4 \strokec4 (\cf9 \strokec9 ck\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cachedWh\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 whCached\cf4 \strokec4  = \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 cachedWh\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 whCached\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ssidCached\cf4 \strokec4  = \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 whCached\cf4 \strokec4 ];\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 ssidCached\cf4 \strokec4 ) \{\cb1 \
\cb3           \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 verifyBirthdayInWarehouse_\cf4 \strokec4 (\cf9 \strokec9 whCached\cf4 \strokec4 , \cf9 \strokec9 ssidCached\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 birthday\cf4 \strokec4 );\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\cb3   \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxSs\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf7 \strokec7 MASTER_INDEX_SPREADSHEET_ID\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxSh\cf4 \strokec4  = \cf9 \strokec9 getSheetByNameCI_\cf4 \strokec4 (\cf9 \strokec9 idxSs\cf4 \strokec4 , \cf7 \strokec7 MASTER_INDEX_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 idxSh\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u25214 \u19981 \u21040  MASTER_INDEX \u20998 \u38913 \u65306 '\cf4 \strokec4  + \cf7 \strokec7 MASTER_INDEX_SHEET_NAME\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxLast\cf4 \strokec4  = \cf9 \strokec9 idxSh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 idxLast\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 'MASTER_INDEX \uc0\u23578 \u28961 \u36039 \u26009 '\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 idxVals\cf4 \strokec4  = \cf9 \strokec9 idxSh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 2\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 idxLast\cf4 \strokec4  - \cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 3\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 warehouseKey\cf4 \strokec4  = \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 idxVals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 idxVals\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ][\cf10 \strokec10 0\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bd\cf4 \strokec4  = \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 idxVals\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ][\cf10 \strokec10 1\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 wh\cf4 \strokec4  = \cf9 \strokec9 normWhKey_\cf4 \strokec4 (\cf9 \strokec9 idxVals\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ][\cf10 \strokec10 2\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nm\cf4 \strokec4  === \cf9 \strokec9 name\cf4 \strokec4  && \cf9 \strokec9 bd\cf4 \strokec4  && \cf9 \strokec9 bd\cf4 \strokec4  === \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 birthday\cf4 \strokec4 )) \{\cb1 \
\cb3       \cf9 \strokec9 warehouseKey\cf4 \strokec4  = \cf9 \strokec9 wh\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 warehouseKey\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u22995 \u21517 \u25110 \u29983 \u26085 \u19981 \u27491 \u30906 \u65288 INDEX\u65289 '\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ssid\cf4 \strokec4  = \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 warehouseKey\cf4 \strokec4 ];\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 ssid\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u20489 \u21029 \u28961 \u25928 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 warehouseKey\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 try\cf4 \strokec4  \{ \cf9 \strokec9 cache\cf4 \strokec4 .\cf9 \strokec9 put\cf4 \strokec4 (\cf9 \strokec9 ck\cf4 \strokec4 , \cf9 \strokec9 warehouseKey\cf4 \strokec4 , \cf10 \strokec10 600\cf4 \strokec4 ); \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 verifyBirthdayInWarehouse_\cf4 \strokec4 (\cf9 \strokec9 warehouseKey\cf4 \strokec4 , \cf9 \strokec9 ssid\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 birthday\cf4 \strokec4 );\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 verifyBirthdayInWarehouse_\cf4 \strokec4 (\cf9 \strokec9 warehouseKey\cf4 \strokec4 , \cf9 \strokec9 ssid\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 birthday\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ss\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf9 \strokec9 ssid\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sh\cf4 \strokec4  = \cf9 \strokec9 getSheetByNameCI_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf7 \strokec7 LOGIN_SHEET_NAME\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sh\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u12300 '\cf4 \strokec4  + \cf7 \strokec7 LOGIN_SHEET_NAME\cf4 \strokec4  + \cf8 \strokec8 '\uc0\u12301 \u20998 \u38913 \u65288 '\cf4 \strokec4  + \cf9 \strokec9 warehouseKey\cf4 \strokec4  + \cf8 \strokec8 '\uc0\u65289 '\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 last\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 last\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u29983 \u26085 \u31649 \u29702 \u23578 \u28961 \u36039 \u26009 \u65288 '\cf4 \strokec4  + \cf9 \strokec9 warehouseKey\cf4 \strokec4  + \cf8 \strokec8 '\uc0\u65289 '\cf4 \strokec4  \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 vals\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 2\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 last\cf4 \strokec4  - \cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 2\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 j\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4  < \cf9 \strokec9 vals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm2\cf4 \strokec4  = \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 j\cf4 \strokec4 ][\cf10 \strokec10 0\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bd2\cf4 \strokec4  = \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 j\cf4 \strokec4 ][\cf10 \strokec10 1\cf4 \strokec4 ]);\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nm2\cf4 \strokec4  === \cf9 \strokec9 name\cf4 \strokec4  && \cf9 \strokec9 bd2\cf4 \strokec4  && \cf9 \strokec9 bd2\cf4 \strokec4  === \cf9 \strokec9 normBirth_\cf4 \strokec4 (\cf9 \strokec9 birthday\cf4 \strokec4 )) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 true\cf4 \strokec4 , \cf9 \strokec9 isAdmin\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 : \cf9 \strokec9 name\cf4 \strokec4 , \cf9 \strokec9 warehouseKey\cf4 \strokec4 : \cf9 \strokec9 warehouseKey\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 ok\cf4 \strokec4 : \cf6 \strokec6 false\cf4 \strokec4 , \cf9 \strokec9 msg\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u22995 \u21517 \u25110 \u29983 \u26085 \u19981 \u27491 \u30906 \u65288 '\cf4 \strokec4  + \cf9 \strokec9 warehouseKey\cf4 \strokec4  + \cf8 \strokec8 ' \uc0\u29983 \u26085 \u31649 \u29702 \u65289 '\cf4 \strokec4  \};\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u35712 \u21462 \u25351 \u23450 \u20998 \u38913 \u30340 \u36039 \u26009 \u65292 \u20006 \u21482 \u20445 \u30041 \u25351 \u23450 \u22995 \u21517 \u30340 \u21015 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u22238 \u20659 \u26684 \u24335 \u65306 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *  \{\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    headers: [...],\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    headersISO: [...],\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    headersTop: [],\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    rows: [\{v:[...], bg:[...], fc:[...], att:[...]\}...],\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    dateCols: [\uc0\u25976 \u23383 ...],\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    frozenLeft: \uc0\u25972 \u25976 ,\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    engine: 'basic',\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *    counts: \{rows:\uc0\u31558 \u25976 , cols:\u27396 \u25976 \}\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *  \}\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 getGridPayloadForName_\cf4 \strokec4 (\cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 spreadsheetId\cf4 \strokec4 , \cf9 \strokec9 nameFilter\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ss\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf9 \strokec9 spreadsheetId\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sh\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheetByName\cf4 \strokec4 (\cf9 \strokec9 sheetName\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sh\cf4 \strokec4 ) \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u20998 \u38913 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 sheetName\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastRow\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastCol\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastColumn\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 frozenLeft\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getFrozenColumns\cf4 \strokec4 () || \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 nameFilter\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nm\cf4 \strokec4  && (\cf9 \strokec9 lastRow\cf4 \strokec4  * \cf9 \strokec9 lastCol\cf4 \strokec4 ) >= \cf10 \strokec10 20000\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 fast\cf4 \strokec4  = \cf9 \strokec9 fastPayloadForName_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 nm\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 , \cf9 \strokec9 frozenLeft\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 fast\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 fast\cf4 \strokec4 ;\cb1 \
\cb3     \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 lastRow\cf4 \strokec4  < \cf10 \strokec10 1\cf4 \strokec4  || \cf9 \strokec9 lastCol\cf4 \strokec4  < \cf10 \strokec10 1\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3       \cf9 \strokec9 headers\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 headersISO\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 headersTop\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 rows\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 dateCols\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 frozenLeft\cf4 \strokec4 : \cf9 \strokec9 frozenLeft\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 engine\cf4 \strokec4 : \cf8 \strokec8 'basic'\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 counts\cf4 \strokec4 : \{ \cf9 \strokec9 rows\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 cols\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4  \}\cb1 \
\cb3     \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u20381 \u20998 \u38913 \u23610 \u23544 \u31777 \u21934 \u24555 \u21462  60 \u31186 \u65288 \u26410 \u20381 \u22995 \u21517 \u21312 \u20998 \u65292 \u22995 \u21517 \u31721 \u36984 \u22312 \u24555 \u21462 \u20043 \u24460 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cache\cf4 \strokec4  = \cf7 \strokec7 CacheService\cf4 \strokec4 .\cf9 \strokec9 getScriptCache\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cacheKey\cf4 \strokec4  = \cf8 \strokec8 'grid:'\cf4 \strokec4  + \cf9 \strokec9 spreadsheetId\cf4 \strokec4  + \cf8 \strokec8 ':'\cf4 \strokec4  + \cf9 \strokec9 sheetName\cf4 \strokec4  + \cf8 \strokec8 ':'\cf4 \strokec4  + \cf9 \strokec9 lastRow\cf4 \strokec4  + \cf8 \strokec8 'x'\cf4 \strokec4  + \cf9 \strokec9 lastCol\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 base\cf4 \strokec4  = \cf6 \strokec6 null\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cached\cf4 \strokec4  = \cf9 \strokec9 cache\cf4 \strokec4 .\cf6 \strokec6 get\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cached\cf4 \strokec4 ) \cf9 \strokec9 base\cf4 \strokec4  = \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 parse\cf4 \strokec4 (\cf9 \strokec9 cached\cf4 \strokec4 );\cb1 \
\cb3   \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 base\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf9 \strokec9 base\cf4 \strokec4  = \cf9 \strokec9 readSheetToPayload_\cf4 \strokec4 (\cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 );\cb1 \
\cb3     \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 frozenLeft\cf4 \strokec4  = \cf9 \strokec9 frozenLeft\cf4 \strokec4 ;\cb1 \
\cb3     \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 engine\cf4 \strokec4  = \cf8 \strokec8 'basic'\cf4 \strokec4 ;\cb1 \
\cb3     \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 counts\cf4 \strokec4  = \{ \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 , \cf9 \strokec9 cols\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  \};\cb1 \
\cb3     \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 json\cf4 \strokec4  = \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\cf9 \strokec9 base\cf4 \strokec4 );\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 json\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  < \cf10 \strokec10 90000\cf4 \strokec4 ) \cf9 \strokec9 cache\cf4 \strokec4 .\cf9 \strokec9 put\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 , \cf9 \strokec9 json\cf4 \strokec4 , \cf10 \strokec10 60\cf4 \strokec4 );\cb1 \
\cb3     \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 _\cf4 \strokec4 ) \{ \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u27794 \u26377 \u25351 \u23450 \u22995 \u21517  \u8594  \u22238 \u20659 \u20840 \u37096 \u65288 \u32102 \u31649 \u29702 \u32773 \u29992 \u65289 \u65292 \u19968 \u27171 \u25499 \u19978 \u20986 \u21220 \u26071 \u27161 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 name\cf4 \strokec4  = \cf9 \strokec9 nm\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 name\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf9 \strokec9 attachAttendanceFlagsForRows_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 base\cf4 \strokec4 , \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 base\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 detectNameColByData_\cf4 \strokec4 (\cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 , \cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 throw\cf4 \strokec4  \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Error\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u22995 \u21517 \u27396 \u20301 \u65306 '\cf4 \strokec4  + \cf9 \strokec9 sheetName\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 filteredRows\cf4 \strokec4  = \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 filter\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 row\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 normName_\cf4 \strokec4 (\cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 row\cf4 \strokec4 .\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 nameCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 )) === \cf9 \strokec9 normName_\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3   \});\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u19968 \u33324 \u20351 \u29992 \u32773  / API \u25351 \u23450 \u22995 \u21517  \u8594  \u20677 \u23565 \u36889 \u20123 \u21015 \u25499 \u19978 \u20986 \u21220 \u26071 \u27161 \cf4 \cb1 \strokec4 \
\cb3   \cf9 \strokec9 attachAttendanceFlagsForRows_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 base\cf4 \strokec4 , \cf9 \strokec9 filteredRows\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3     \cf9 \strokec9 headers\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 headersISO\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headersISO\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 headersTop\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headersTop\cf4 \strokec4  || [],\cb1 \
\cb3     \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 filteredRows\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 dateCols\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 dateCols\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 frozenLeft\cf4 \strokec4 : \cf9 \strokec9 frozenLeft\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 engine\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 engine\cf4 \strokec4  || \cf8 \strokec8 'basic'\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 counts\cf4 \strokec4 : \{ \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 filteredRows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 , \cf9 \strokec9 cols\cf4 \strokec4 : \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  \}\cb1 \
\cb3   \};\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u25226 \u25972 \u20491 \u20998 \u38913 \u35712 \u25104  payload\u65288 \u19981 \u20570 \u22995 \u21517 \u31721 \u36984 \u65289 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u9989  \u25903 \u25588 \u12300 \u34920 \u38957  1 \u21015 \u25110  2 \u21015 \u12301 \u65306 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *   - \uc0\u26371 \u33258 \u21205 \u21028 \u26039 \u21738 \u19968 \u21015 \u25165 \u26159 \u12300 \u30495 \u27491 \u27396 \u20301 \u34920 \u38957 \u12301 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  *   - TAO3 \uc0\u36889 \u31278 \u19978 \u38754 \u22810 \u19968 \u21015 \u27161 \u38988 \u30340 \u29677 \u34920 \u23601 \u19981 \u26371 \u34987 \u31639 \u36914 \u36039 \u26009 \u21015 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 readSheetToPayload_\cf4 \strokec4 (\cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rng\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 values\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bgs\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getBackgrounds\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 fcs\cf4 \strokec4  = \cf9 \strokec9 rng\cf4 \strokec4 .\cf9 \strokec9 getFontColors\cf4 \strokec4 ();\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 values\cf4 \strokec4  || !\cf9 \strokec9 values\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3       \cf9 \strokec9 headers\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 headersISO\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 headersTop\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 rows\cf4 \strokec4 : [],\cb1 \
\cb3       \cf9 \strokec9 dateCols\cf4 \strokec4 : []\cb1 \
\cb3     \};\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u26681 \u25818 \u21069 \u24190 \u21015 \u20839 \u23481 \u33258 \u21205 \u21028 \u26039 \u30495 \u27491 \u34920 \u38957 \u21015 \u65288 \u25903 \u25588  1 \u25110  2 \u21015 \u34920 \u38957 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headerRowIndex\cf4 \strokec4  = \cf9 \strokec9 detectHeaderRowIndex_\cf4 \strokec4 (\cf9 \strokec9 values\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headers\cf4 \strokec4  = \cf9 \strokec9 values\cf4 \strokec4 [\cf9 \strokec9 headerRowIndex\cf4 \strokec4 ] || [];\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headersISO\cf4 \strokec4  = \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 map\cf4 \strokec4 (\cf9 \strokec9 guessISOFromHeaderText_\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCols\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 headersISO\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 headersISO\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ]) \cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\cf9 \strokec9 i\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rows\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 r\cf4 \strokec4  = \cf9 \strokec9 headerRowIndex\cf4 \strokec4  + \cf10 \strokec10 1\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4  < \cf9 \strokec9 values\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\{\cb1 \
\cb3       \cf9 \strokec9 v\cf4 \strokec4 : \cf9 \strokec9 values\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ].\cf9 \strokec9 map\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 x\cf4 \strokec4 ) \{ \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 x\cf4 \strokec4  == \cf6 \strokec6 null\cf4 \strokec4  ? \cf8 \strokec8 ''\cf4 \strokec4  : \cf9 \strokec9 x\cf4 \strokec4 ); \}),\cb1 \
\cb3       \cf9 \strokec9 bg\cf4 \strokec4 : \cf9 \strokec9 bgs\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ].\cf9 \strokec9 slice\cf4 \strokec4 (),\cb1 \
\cb3       \cf9 \strokec9 fc\cf4 \strokec4 : \cf9 \strokec9 fcs\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ].\cf9 \strokec9 slice\cf4 \strokec4 ()\cb1 \
\cb3       \cf2 \strokec2 // att \uc0\u20043 \u24460 \u22312  attachAttendanceFlagsForRows_ \u20877 \u21152 \cf4 \cb1 \strokec4 \
\cb3     \});\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3     \cf9 \strokec9 headers\cf4 \strokec4 : \cf9 \strokec9 headers\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 headersISO\cf4 \strokec4 : \cf9 \strokec9 headersISO\cf4 \strokec4 ,\cb1 \
\cb3     \cf2 \strokec2 // \uc0\u33509 \u26377  2 \u21015 \u34920 \u38957 \u65292 \u36889 \u35041 \u20808 \u20445 \u30041 \u31532 \u19968 \u21015 \u65288 \u30446 \u21069 \u21069 \u31471 \u27794 \u29992 \u21040 \u65292 \u21482 \u20570 \u20633 \u20221 \u65289 \cf4 \cb1 \strokec4 \
\cb3     \cf9 \strokec9 headersTop\cf4 \strokec4 : \cf9 \strokec9 headerRowIndex\cf4 \strokec4  > \cf10 \strokec10 0\cf4 \strokec4  ? \cf9 \strokec9 values\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ] : [],\cb1 \
\cb3     \cf9 \strokec9 rows\cf4 \strokec4 : \cf9 \strokec9 rows\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 dateCols\cf4 \strokec4 : \cf9 \strokec9 dateCols\cf4 \cb1 \strokec4 \
\cb3   \};\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u22039 \u35430  decode \u19968 \u27425  URL \u32232 \u30908  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 tryDecodeOnce_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 s\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 decodeURIComponent\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 );\cb1 \
\cb3   \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 s\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /** \uc0\u25214 \u12300 \u22995 \u21517 \u12301 \u27396 \u20301 \u20301 \u32622 \u65288 \u21152 \u24375 \u29256 \u65292 \u25903 \u25588 \u22810 \u31278 \u23531 \u27861 \u65289  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 headers\cf4 \strokec4  || !\cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u20808 \u27604 \u23565 \u23436 \u20840 \u30456 \u21516 \u30340 \u27396 \u21517 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf7 \strokec7 EXACT\cf4 \strokec4  = [\cf8 \strokec8 '\uc0\u22995 \u21517 '\cf4 \strokec4 , \cf8 \strokec8 'Name'\cf4 \strokec4 , \cf8 \strokec8 'name'\cf4 \strokec4 , \cf8 \strokec8 '\uc0\u21729 \u24037 \u22995 \u21517 '\cf4 \strokec4 , \cf8 \strokec8 '\uc0\u22995 \u21517 (\u24517 \u22635 )'\cf4 \strokec4 , \cf8 \strokec8 '\uc0\u20013 \u25991 \u22995 \u21517 '\cf4 \strokec4 ];\cb1 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 h\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 h\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf7 \strokec7 EXACT\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf9 \strokec9 h\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u20877 \u29992 \u12300 \u21253 \u21547 \u38364 \u37749 \u23383 \u12301 \u30340 \u26041 \u24335 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 j\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4  < \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 hh\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 [\cf9 \strokec9 j\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 hh\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cb1 \
\cb3       \cf9 \strokec9 hh\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u22995 \u21517 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4  ||\cb1 \
\cb3       \cf9 \strokec9 hh\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u21729 \u24037 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4  ||\cb1 \
\cb3       \cf11 \strokec11 /^name$/\cf6 \strokec6 i\cf4 \strokec4 .\cf9 \strokec9 test\cf4 \strokec4 (\cf9 \strokec9 hh\cf4 \strokec4 ) ||\cb1 \
\cb3       \cf11 \strokec11 /employee/\cf6 \strokec6 i\cf4 \strokec4 .\cf9 \strokec9 test\cf4 \strokec4 (\cf9 \strokec9 hh\cf4 \strokec4 )\cb1 \
\cb3     ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 j\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\cb3   \cf6 \strokec6 return\cf4 \strokec4  -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u24478 \u34920 \u38957 \u25991 \u23383 \u25110 \u26085 \u26399 \u23383 \u20018 \u29468 \u26085 \u26399 \u65288 yyyy/mm/dd\u12289 mm/dd\u12289 yyyy\u24180 m\u26376 d\u26085 \u12289 m\u26376 d\u26085 \u65289 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u22238 \u20659  'YYYY-MM-DD' \u25110 \u31354 \u23383 \u20018 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 guessISOFromHeaderText_\cf4 \strokec4 (\cf9 \strokec9 t\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 s\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 t\cf4 \strokec4  || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 s\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf2 \strokec2 // yyyy/mm/dd \uc0\u25110  yyyy-mm-dd\cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 m\cf4 \strokec4  = \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 match\cf4 \strokec4 (\cf11 \strokec11 /^(\\d\{4\})[\\/\\-](\\d\{1,2\})[\\/\\-](\\d\{1,2\})$/\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 m\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 y\cf4 \strokec4  = \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 1\cf4 \strokec4 ];\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 mo\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 2\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 d\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 3\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 y\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 mo\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 d\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // mm/dd \uc0\u25110  m/d\u65288 \u27794 \u24180 \u20221 \u26178 \u29992 \u20170 \u24180 \u65289 \cf4 \cb1 \strokec4 \
\cb3   \cf9 \strokec9 m\cf4 \strokec4  = \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 match\cf4 \strokec4 (\cf11 \strokec11 /^(\\d\{1,2\})[\\/\\-](\\d\{1,2\})$/\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 m\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 year\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 ().\cf9 \strokec9 getFullYear\cf4 \strokec4 ());\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 mo2\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 1\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 d2\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 2\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 year\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 mo2\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 d2\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf2 \strokec2 // yyyy\uc0\u24180 m\u26376 d\u26085  \u25110  m\u26376 d\u26085 \cf4 \cb1 \strokec4 \
\cb3   \cf9 \strokec9 m\cf4 \strokec4  = \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 match\cf4 \strokec4 (\cf11 \strokec11 /^(?:(\\d\{4\})\uc0\u24180 )?\\s*(\\d\{1,2\})\u26376 \\s*(\\d\{1,2\})\u26085 $/\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 m\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 yy\cf4 \strokec4  = \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 1\cf4 \strokec4 ] || \cf7 \strokec7 String\cf4 \strokec4 (\cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 ().\cf9 \strokec9 getFullYear\cf4 \strokec4 ());\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 mo3\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 2\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 d3\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 m\cf4 \strokec4 [\cf10 \strokec10 3\cf4 \strokec4 ]).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 yy\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 mo3\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 d3\cf4 \strokec4 ;\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf8 \strokec8 ''\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u26681 \u25818 \u21069 \u24190 \u21015 \u20839 \u23481 \u33258 \u21205 \u21028 \u26039 \u30495 \u27491 \u30340 \u27396 \u20301 \u34920 \u38957 \u25152 \u22312 \u21015 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * - \uc0\u26371 \u32156 \u21512 \u12300 \u26159 \u21542 \u21253 \u21547 \u22995 \u21517 /\u37096 \u38272 \u38364 \u37749 \u23383 \u12301 \u12289 \u12300 \u26159 \u21542 \u26377 \u26085 \u26399 \u26684 \u24335 \u12301 \u12289 \u12300 \u38750 \u31354 \u27396 \u20301 \u25976 \u12301 \u20358 \u35413 \u20998 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * - \uc0\u30446 \u21069 \u21482 \u27298 \u26597 \u21069  3 \u21015 \u65292 \u22238 \u20659  0-based index\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * - TAO3 \uc0\u37027 \u31278 \u19978 \u38754 \u21482 \u26377 \u19968 \u34892 \u22823 \u27161 \u38988 \u12289 \u19979 \u38754 \u25165 \u26159 \u27491 \u24335 \u34920 \u38957 \u65292 \u26371 \u33258 \u21205 \u36984 \u19979 \u38754 \u37027 \u19968 \u21015 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 detectHeaderRowIndex_\cf4 \strokec4 (\cf9 \strokec9 values\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 values\cf4 \strokec4  || !\cf9 \strokec9 values\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4  \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 maxCheck\cf4 \strokec4  = \cf7 \strokec7 Math\cf4 \strokec4 .\cf9 \strokec9 min\cf4 \strokec4 (\cf9 \strokec9 values\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 , \cf10 \strokec10 3\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bestIdx\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 bestScore\cf4 \strokec4  = -\cf10 \strokec10 9999\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 maxCheck\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 row\cf4 \strokec4  = \cf9 \strokec9 values\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ] || [];\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nonEmpty\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 hasName\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 hasDept\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCount\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 j\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4  < \cf9 \strokec9 row\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 s\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 row\cf4 \strokec4 [\cf9 \strokec9 j\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 s\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 nonEmpty\cf4 \strokec4 ++;\cb1 \
\
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cb1 \
\cb3         \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u22995 \u21517 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4  ||\cb1 \
\cb3         \cf11 \strokec11 /^name$/\cf6 \strokec6 i\cf4 \strokec4 .\cf9 \strokec9 test\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 ) ||\cb1 \
\cb3         \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u21729 \u24037 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \cb1 \strokec4 \
\cb3       ) \{\cb1 \
\cb3         \cf9 \strokec9 hasName\cf4 \strokec4  = \cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cb1 \
\cb3         \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u32068 \u21029 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4  ||\cb1 \
\cb3         \cf9 \strokec9 s\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u37096 \u38272 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4  ||\cb1 \
\cb3         \cf11 \strokec11 /dept|department|group/\cf6 \strokec6 i\cf4 \strokec4 .\cf9 \strokec9 test\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 )\cb1 \
\cb3       ) \{\cb1 \
\cb3         \cf9 \strokec9 hasDept\cf4 \strokec4  = \cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 guessISOFromHeaderText_\cf4 \strokec4 (\cf9 \strokec9 s\cf4 \strokec4 )) \{\cb1 \
\cb3         \cf9 \strokec9 dateCount\cf4 \strokec4 ++;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 score\cf4 \strokec4  = \cf9 \strokec9 nonEmpty\cf4 \strokec4  + \cf9 \strokec9 hasName\cf4 \strokec4  * \cf10 \strokec10 5\cf4 \strokec4  + \cf9 \strokec9 hasDept\cf4 \strokec4  * \cf10 \strokec10 3\cf4 \strokec4  + \cf9 \strokec9 dateCount\cf4 \strokec4  * \cf10 \strokec10 2\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u33509 \u21482 \u26377 \u19968 \u20491 \u27396 \u20301 \u26377 \u23383 \u65292 \u32780 \u19988 \u20687 \u26159 \u25972 \u34920 \u27161 \u38988 \u65288 \u27396 \u25976 \u36611 \u22810 \u20294 \u21482 \u26377 \u31532 \u19968 \u26684 \u38263 \u23383 \u65289 \u65292 \u31245 \u24494 \u25187 \u20998 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nonEmpty\cf4 \strokec4  === \cf10 \strokec10 1\cf4 \strokec4  && \cf9 \strokec9 row\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  >= \cf10 \strokec10 4\cf4 \strokec4  && \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 row\cf4 \strokec4 [\cf10 \strokec10 0\cf4 \strokec4 ]).\cf9 \strokec9 length\cf4 \strokec4  > \cf10 \strokec10 4\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf9 \strokec9 score\cf4 \strokec4  -= \cf10 \strokec10 3\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 score\cf4 \strokec4  > \cf9 \strokec9 bestScore\cf4 \strokec4  || (\cf9 \strokec9 score\cf4 \strokec4  === \cf9 \strokec9 bestScore\cf4 \strokec4  && \cf9 \strokec9 i\cf4 \strokec4  > \cf9 \strokec9 bestIdx\cf4 \strokec4 )) \{\cb1 \
\cb3       \cf9 \strokec9 bestScore\cf4 \strokec4  = \cf9 \strokec9 score\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 bestIdx\cf4 \strokec4  = \cf9 \strokec9 i\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 bestIdx\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u23565 \u12300 \u29677 \u34920 \u12301 \u20998 \u38913 \u30340 \u36039 \u26009 \u21015 \u65292 \u20381 \u22995 \u21517 \u65291 \u26085 \u26399 \u25499 \u19978 \u20986 \u21220 \u26071 \u27161  row.att\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * row.att[\uc0\u27396 \u32034 \u24341 ] = 1 \u34920 \u31034 \u35442 \u26085 \u26377 \u20986 \u21220 \u32000 \u37636 \u65292 0 \u34920 \u31034 \u27794 \u26377 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 attachAttendanceFlagsForRows_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 , \cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 base\cf4 \strokec4 , \cf9 \strokec9 rows\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 rows\cf4 \strokec4  || !\cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetName\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ) < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ; \cf2 \strokec2 // \uc0\u21482 \u34389 \u29702 \u29677 \u34920 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCols\cf4 \strokec4  = \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 dateCols\cf4 \strokec4  || [];\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headersISO\cf4 \strokec4  = \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headersISO\cf4 \strokec4  || [];\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 attMap\cf4 \strokec4  = \cf9 \strokec9 buildAttendanceMap_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 );\cb1 \
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 attMap\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 forEach\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 row\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 row\cf4 \strokec4 .\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 nameCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 nm\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 att\cf4 \strokec4  = [];\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 base\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \cf9 \strokec9 att\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ] = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 forEach\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 ci\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 iso\cf4 \strokec4  = \cf9 \strokec9 headersISO\cf4 \strokec4 [\cf9 \strokec9 ci\cf4 \strokec4 ];\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 iso\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 key\cf4 \strokec4  = \cf9 \strokec9 nm\cf4 \strokec4  + \cf8 \strokec8 '|'\cf4 \strokec4  + \cf9 \strokec9 iso\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 att\cf4 \strokec4 [\cf9 \strokec9 ci\cf4 \strokec4 ] = \cf9 \strokec9 attMap\cf4 \strokec4 [\cf9 \strokec9 key\cf4 \strokec4 ] ? \cf10 \strokec10 1\cf4 \strokec4  : \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\cb3     \});\cb1 \
\
\cb3     \cf9 \strokec9 row\cf4 \strokec4 .\cf9 \strokec9 att\cf4 \strokec4  = \cf9 \strokec9 att\cf4 \strokec4 ;\cb1 \
\cb3   \});\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u24314 \u31435 \u20986 \u21220 \u32000 \u37636 \u26597 \u35426  map\u65306  key = \u22995 \u21517 |YYYY-MM-DD \u8594  true\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u21482 \u25235 \u20998 \u38913 \u21517 \u31281 \u21547 \u12300 \u20986 \u21220 \u26178 \u25976  / \u20986 \u21220 \u26178 \u38291  / \u20986 \u21220 \u20633 \u20221 \u12301 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u9989  \u21516 \u27171 \u25903 \u25588 \u12300 \u34920 \u38957  2 \u21015 \u12301 \u30340 \u20986 \u21220 \u34920 \u65306 \u33258 \u21205 \u21028 \u26039 \u30495 \u27491 \u34920 \u38957 \u21015 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 buildAttendanceMap_\cf4 \strokec4 (\cf9 \strokec9 ss\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 map\cf4 \strokec4  = \{\};\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheets\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheets\cf4 \strokec4 ();\cb1 \
\cb3   \cf9 \strokec9 sheets\cf4 \strokec4 .\cf9 \strokec9 forEach\cf4 \strokec4 (\cf6 \strokec6 function\cf4 \strokec4  (\cf9 \strokec9 sh\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sn\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getName\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u21482 \u35201 \u12300 \u20998 \u38913 \u21517 \u31281 \u20839 \u21547 \u12301 \u20197 \u19979 \u38364 \u37749 \u23383 \u20043 \u19968 \u23601 \u31639 \u20986 \u21220 \u20998 \u38913 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cb1 \
\cb3       \cf9 \strokec9 sn\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u20986 \u21220 \u26178 \u25976 '\cf4 \strokec4 ) < \cf10 \strokec10 0\cf4 \strokec4  &&\cb1 \
\cb3       \cf9 \strokec9 sn\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u20986 \u21220 \u26178 \u38291 '\cf4 \strokec4 ) < \cf10 \strokec10 0\cf4 \strokec4  &&\cb1 \
\cb3       \cf9 \strokec9 sn\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u20986 \u21220 \u20633 \u20221 '\cf4 \strokec4 ) < \cf10 \strokec10 0\cf4 \cb1 \strokec4 \
\cb3     ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastRow\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastCol\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastColumn\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 lastRow\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4  || \cf9 \strokec9 lastCol\cf4 \strokec4  < \cf10 \strokec10 1\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 vals\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getRange\cf4 \strokec4 (\cf10 \strokec10 1\cf4 \strokec4 , \cf10 \strokec10 1\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 ).\cf9 \strokec9 getDisplayValues\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u36889 \u35041 \u20063 \u29992 \u21516 \u19968 \u22871 \u21028 \u26039 \u37007 \u36655 \u65292 \u25903 \u25588 \u34920 \u38957  1 \u25110  2 \u21015 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headerRowIndex\cf4 \strokec4  = \cf9 \strokec9 detectHeaderRowIndex_\cf4 \strokec4 (\cf9 \strokec9 vals\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headers\cf4 \strokec4  = \cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 headerRowIndex\cf4 \strokec4 ] || [];\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u22995 \u21517 \u27396 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u26085 \u26399 \u27396 \u65306 \u27396 \u20301 \u21517 \u31281 \u21482 \u35201 \u12300 \u21253 \u21547 \u12302 \u26085 \u26399 \u12303 \u20841 \u20491 \u23383 \u12301 \u23601 \u31639 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCol\cf4 \strokec4  = -\cf10 \strokec10 1\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 headers\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 h\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 h\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u26085 \u26399 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 dateCol\cf4 \strokec4  = \cf9 \strokec9 i\cf4 \strokec4 ;\cb1 \
\cb3         \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4  || \cf9 \strokec9 dateCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 return\cf4 \strokec4 ; \cf2 \strokec2 // \uc0\u36889 \u24373 \u34920 \u25214 \u19981 \u21040 \u22995 \u21517 \u25110 \u26085 \u26399 \u65292 \u23601 \u30053 \u36942 \cf4 \cb1 \strokec4 \
\
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 r\cf4 \strokec4  = \cf9 \strokec9 headerRowIndex\cf4 \strokec4  + \cf10 \strokec10 1\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4  < \cf9 \strokec9 vals\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 r\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nm\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ][\cf9 \strokec9 nameCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ds\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 vals\cf4 \strokec4 [\cf9 \strokec9 r\cf4 \strokec4 ][\cf9 \strokec9 dateCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 nm\cf4 \strokec4  || !\cf9 \strokec9 ds\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u20778 \u20808 \u29992  guessISOFromHeaderText_\u65288 \u21507  yyyy/mm/dd\u12289 m/d\u12289 yyyy\u24180 m\u26376 d\u26085 \'85\u65289 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 iso\cf4 \strokec4  = \cf9 \strokec9 guessISOFromHeaderText_\cf4 \strokec4 (\cf9 \strokec9 ds\cf4 \strokec4 );\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u33509 \u19978 \u38754 \u27794 \u35299 \u26512 \u20986 \u20358 \u65292 \u20877 \u35430 \u29992  new Date() \u35299 \u26512 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 iso\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 d\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Date\cf4 \strokec4 (\cf9 \strokec9 ds\cf4 \strokec4 );\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 isNaN\cf4 \strokec4 (\cf9 \strokec9 d\cf4 \strokec4 .\cf9 \strokec9 getTime\cf4 \strokec4 ())) \{\cb1 \
\cb3           \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 y\cf4 \strokec4  = \cf9 \strokec9 d\cf4 \strokec4 .\cf9 \strokec9 getFullYear\cf4 \strokec4 ();\cb1 \
\cb3           \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 mo\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + (\cf9 \strokec9 d\cf4 \strokec4 .\cf9 \strokec9 getMonth\cf4 \strokec4 () + \cf10 \strokec10 1\cf4 \strokec4 )).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3           \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 da\cf4 \strokec4  = (\cf8 \strokec8 '0'\cf4 \strokec4  + \cf9 \strokec9 d\cf4 \strokec4 .\cf9 \strokec9 getDate\cf4 \strokec4 ()).\cf9 \strokec9 slice\cf4 \strokec4 (-\cf10 \strokec10 2\cf4 \strokec4 );\cb1 \
\cb3           \cf9 \strokec9 iso\cf4 \strokec4  = \cf9 \strokec9 y\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 mo\cf4 \strokec4  + \cf8 \strokec8 '-'\cf4 \strokec4  + \cf9 \strokec9 da\cf4 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 iso\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 key\cf4 \strokec4  = \cf9 \strokec9 nm\cf4 \strokec4  + \cf8 \strokec8 '|'\cf4 \strokec4  + \cf9 \strokec9 iso\cf4 \strokec4 ;\cb1 \
\cb3       \cf9 \strokec9 map\cf4 \strokec4 [\cf9 \strokec9 key\cf4 \strokec4 ] = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3     \}\cb1 \
\cb3   \});\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 map\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u32113 \u35336 \u25152 \u26377 \u20489 \u21029 \u20154 \u25976 \u65288 \u19981 \u37325 \u35079 \u65289  - \u20462 \u27491 \u29256 \u26412 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u22238 \u20659 \u26684 \u24335 \u65306 \{ total: \u32317 \u20154 \u25976 , details: [\{warehouse: \u20489 \u21029 , month: \u26376 \u20221 , count: \u20154 \u25976 , leaveCount: \u38626 \u32887 \u20154 \u25976 \}, ...] \}\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 getAllPeopleCount_\cf4 \strokec4 () \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cache\cf4 \strokec4  = \cf7 \strokec7 CacheService\cf4 \strokec4 .\cf9 \strokec9 getScriptCache\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cacheKey\cf4 \strokec4  = \cf8 \strokec8 'allPeopleCount_v3'\cf4 \strokec4 ; \cf2 \strokec2 // \uc0\u26356 \u26032 \u24555 \u21462 \u37749 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cached\cf4 \strokec4  = \cf9 \strokec9 cache\cf4 \strokec4 .\cf6 \strokec6 get\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cached\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 parse\cf4 \strokec4 (\cf9 \strokec9 cached\cf4 \strokec4 );\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 allPeople\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Set\cf4 \strokec4 ();\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 details\cf4 \strokec4  = [];\cb1 \
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 total\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u36941 \u27511 \u25152 \u26377 \u20489 \u21029 \cf4 \cb1 \strokec4 \
\cb3   \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 warehouseKey\cf4 \strokec4  \cf6 \strokec6 in\cf4 \strokec4  \cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ss\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 warehouseKey\cf4 \strokec4 ]);\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetNames\cf4 \strokec4  = \cf9 \strokec9 getSheetNames_\cf4 \strokec4 (\cf7 \strokec7 WAREHOUSE_IDS\cf4 \strokec4 [\cf9 \strokec9 warehouseKey\cf4 \strokec4 ]);\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u23563 \u25214 \u25152 \u26377 \u29677 \u34920 \u20998 \u38913 \u65288 \u21517 \u31281 \u21253 \u21547 \u12300 \u29677 \u34920 \u12301 \u65289 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 scheduleSheets\cf4 \strokec4  = [];\cb1 \
\cb3       \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 sheetNames\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNames\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ].\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3           \cf9 \strokec9 scheduleSheets\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\cf9 \strokec9 sheetNames\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ]);\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 scheduleSheets\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4  === \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 details\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\{\cb1 \
\cb3           \cf9 \strokec9 warehouse\cf4 \strokec4 : \cf9 \strokec9 warehouseKey\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 month\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u28961 \u29677 \u34920 '\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 count\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 leaveCount\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \cb1 \strokec4 \
\cb3         \});\cb1 \
\cb3         \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u34389 \u29702 \u27599 \u20491 \u29677 \u34920 \u20998 \u38913 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 j\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4  < \cf9 \strokec9 scheduleSheets\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 j\cf4 \strokec4 ++) \{\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 scheduleSheetName\cf4 \strokec4  = \cf9 \strokec9 scheduleSheets\cf4 \strokec4 [\cf9 \strokec9 j\cf4 \strokec4 ];\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sh\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheetByName\cf4 \strokec4 (\cf9 \strokec9 scheduleSheetName\cf4 \strokec4 );\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sh\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastRow\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastCol\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastColumn\cf4 \strokec4 ();\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 lastRow\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4  || \cf9 \strokec9 lastCol\cf4 \strokec4  < \cf10 \strokec10 1\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3         \cf2 \strokec2 // \uc0\u35712 \u21462 \u36039 \u26009 \cf4 \cb1 \strokec4 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 data\cf4 \strokec4  = \cf9 \strokec9 readSheetToPayload_\cf4 \strokec4 (\cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 );\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headers\cf4 \strokec4  = \cf9 \strokec9 data\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 ;\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rows\cf4 \strokec4  = \cf9 \strokec9 data\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 ;\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3         \cf2 \strokec2 // \uc0\u25214 \u20986 \u26085 \u26399 \u27396 \u20301 \cf4 \cb1 \strokec4 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 dateCols\cf4 \strokec4  = \cf9 \strokec9 data\cf4 \strokec4 .\cf9 \strokec9 dateCols\cf4 \strokec4  || [];\cb1 \
\
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 warehousePeople\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Set\cf4 \strokec4 ();\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 leavePeople\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Set\cf4 \strokec4 ();\cb1 \
\
\cb3         \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 k\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 k\cf4 \strokec4  < \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 k\cf4 \strokec4 ++) \{\cb1 \
\cb3           \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 name\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 k\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 nameCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3           \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 name\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3           \cf2 \strokec2 // \uc0\u9989  \u20462 \u27491 \u65306 \u27298 \u26597 \u25152 \u26377 \u26085 \u26399 \u27396 \u20301 \u20013 \u26159 \u21542 \u26377 \u12300 \u38626 \u12301 \u25991 \u23383 \cf4 \cb1 \strokec4 \
\cb3           \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 isLeave\cf4 \strokec4  = \cf6 \strokec6 false\cf4 \strokec4 ;\cb1 \
\cb3           \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 d\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 d\cf4 \strokec4  < \cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 d\cf4 \strokec4 ++) \{\cb1 \
\cb3             \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cellValue\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 k\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 dateCols\cf4 \strokec4 [\cf9 \strokec9 d\cf4 \strokec4 ]] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3             \cf2 \strokec2 // \uc0\u27298 \u26597 \u26159 \u21542 \u21253 \u21547 \u12300 \u38626 \u12301 \u23383 \cf4 \cb1 \strokec4 \
\cb3             \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cellValue\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u38626 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3               \cf9 \strokec9 isLeave\cf4 \strokec4  = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3               \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3             \}\cb1 \
\cb3           \}\cb1 \
\
\cb3           \cf2 \strokec2 // \uc0\u9989  \u20462 \u27491 \u65306 \u27298 \u26597 \u20854 \u20182 \u27396 \u20301 \u65288 \u38750 \u26085 \u26399 \u27396 \u20301 \u65289 \u26159 \u21542 \u21253 \u21547 \u12300 \u38626 \u12301 \u23383 \cf4 \cb1 \strokec4 \
\cb3           \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 isLeave\cf4 \strokec4 ) \{\cb1 \
\cb3             \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 col\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 col\cf4 \strokec4  < \cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 k\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 col\cf4 \strokec4 ++) \{\cb1 \
\cb3               \cf2 \strokec2 // \uc0\u36339 \u36942 \u26085 \u26399 \u27396 \u20301 \u65288 \u24050 \u32147 \u27298 \u26597 \u36942 \u65289 \cf4 \cb1 \strokec4 \
\cb3               \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 dateCols\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf9 \strokec9 col\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3               \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 otherCellValue\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 k\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 col\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3               \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 otherCellValue\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u38626 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3                 \cf9 \strokec9 isLeave\cf4 \strokec4  = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3                 \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3               \}\cb1 \
\cb3             \}\cb1 \
\cb3           \}\cb1 \
\
\cb3           \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 isLeave\cf4 \strokec4 ) \{\cb1 \
\cb3             \cf9 \strokec9 leavePeople\cf4 \strokec4 .\cf9 \strokec9 add\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3           \} \cf6 \strokec6 else\cf4 \strokec4  \{\cb1 \
\cb3             \cf9 \strokec9 warehousePeople\cf4 \strokec4 .\cf9 \strokec9 add\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3           \}\cb1 \
\cb3           \cf9 \strokec9 allPeople\cf4 \strokec4 .\cf9 \strokec9 add\cf4 \strokec4 (\cf9 \strokec9 warehouseKey\cf4 \strokec4  + \cf8 \strokec8 '_'\cf4 \strokec4  + \cf9 \strokec9 name\cf4 \strokec4 ); \cf2 \strokec2 // \uc0\u21152 \u20837 \u20489 \u21029 \u21069 \u32180 \u36991 \u20813 \u36328 \u20489 \u37325 \u35079 \cf4 \cb1 \strokec4 \
\cb3         \}\cb1 \
\
\cb3         \cf2 \strokec2 // \uc0\u25552 \u21462 \u26376 \u20221 \u36039 \u35338 \u65288 \u24478 \u20998 \u38913 \u21517 \u31281 \u65289 \cf4 \cb1 \strokec4 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 month\cf4 \strokec4  = \cf8 \strokec8 '\uc0\u20854 \u20182 \u26376 \u20221 '\cf4 \strokec4 ;\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sheetNameMatch\cf4 \strokec4  = \cf9 \strokec9 scheduleSheetName\cf4 \strokec4 .\cf9 \strokec9 match\cf4 \strokec4 (\cf11 \strokec11 /(\\d\{1,2\})\uc0\u26376 /\cf4 \strokec4 );\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 sheetNameMatch\cf4 \strokec4 ) \{\cb1 \
\cb3           \cf9 \strokec9 month\cf4 \strokec4  = \cf9 \strokec9 sheetNameMatch\cf4 \strokec4 [\cf10 \strokec10 1\cf4 \strokec4 ] + \cf8 \strokec8 '\uc0\u26376 '\cf4 \strokec4 ;\cb1 \
\cb3         \} \cf6 \strokec6 else\cf4 \strokec4  \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 scheduleSheetName\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3           \cf2 \strokec2 // \uc0\u22914 \u26524 \u27794 \u26377 \u26376 \u20221 \u36039 \u35338 \u65292 \u20351 \u29992 \u20998 \u38913 \u21517 \u31281 \cf4 \cb1 \strokec4 \
\cb3           \cf9 \strokec9 month\cf4 \strokec4  = \cf9 \strokec9 scheduleSheetName\cf4 \strokec4 .\cf9 \strokec9 replace\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 , \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 () || \cf8 \strokec8 '\uc0\u29677 \u34920 '\cf4 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\
\cb3         \cf9 \strokec9 details\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\{\cb1 \
\cb3           \cf9 \strokec9 warehouse\cf4 \strokec4 : \cf9 \strokec9 warehouseKey\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 month\cf4 \strokec4 : \cf9 \strokec9 month\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 count\cf4 \strokec4 : \cf9 \strokec9 warehousePeople\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4  + \cf9 \strokec9 leavePeople\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 , \cf2 \strokec2 // \uc0\u32317 \u20154 \u25976 \u65288 \u21547 \u38626 \u32887 \u65289 \cf4 \cb1 \strokec4 \
\cb3           \cf9 \strokec9 leaveCount\cf4 \strokec4 : \cf9 \strokec9 leavePeople\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 ,\cb1 \
\cb3           \cf9 \strokec9 activeCount\cf4 \strokec4 : \cf9 \strokec9 warehousePeople\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \cb1 \strokec4 \
\cb3         \});\cb1 \
\cb3       \}\cb1 \
\
\cb3     \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf9 \strokec9 console\cf4 \strokec4 .\cf9 \strokec9 error\cf4 \strokec4 (\cf8 \strokec8 'Error processing warehouse '\cf4 \strokec4  + \cf9 \strokec9 warehouseKey\cf4 \strokec4  + \cf8 \strokec8 ': '\cf4 \strokec4  + \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 toString\cf4 \strokec4 ());\cb1 \
\cb3       \cf9 \strokec9 details\cf4 \strokec4 .\cf9 \strokec9 push\cf4 \strokec4 (\{\cb1 \
\cb3         \cf9 \strokec9 warehouse\cf4 \strokec4 : \cf9 \strokec9 warehouseKey\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 month\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u37679 \u35492 '\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 count\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 leaveCount\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 ,\cb1 \
\cb3         \cf9 \strokec9 error\cf4 \strokec4 : \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 toString\cf4 \strokec4 ()\cb1 \
\cb3       \});\cb1 \
\cb3     \}\cb1 \
\cb3   \}\cb1 \
\
\cb3   \cf9 \strokec9 total\cf4 \strokec4  = \cf9 \strokec9 allPeople\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 ;\cb1 \
\
\cb3   \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 result\cf4 \strokec4  = \{\cb1 \
\cb3     \cf9 \strokec9 total\cf4 \strokec4 : \cf9 \strokec9 total\cf4 \strokec4 ,\cb1 \
\cb3     \cf9 \strokec9 details\cf4 \strokec4 : \cf9 \strokec9 details\cf4 \cb1 \strokec4 \
\cb3   \};\cb1 \
\
\cb3   \cf2 \strokec2 // \uc0\u24555 \u21462  5 \u20998 \u37912 \cf4 \cb1 \strokec4 \
\cb3   \cf9 \strokec9 cache\cf4 \strokec4 .\cf9 \strokec9 put\cf4 \strokec4 (\cf9 \strokec9 cacheKey\cf4 \strokec4 , \cf7 \strokec7 JSON\cf4 \strokec4 .\cf9 \strokec9 stringify\cf4 \strokec4 (\cf9 \strokec9 result\cf4 \strokec4 ), \cf10 \strokec10 300\cf4 \strokec4 );\cb1 \
\
\cb3   \cf6 \strokec6 return\cf4 \strokec4  \cf9 \strokec9 result\cf4 \strokec4 ;\cb1 \
\cb3 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf5 \cb3 \strokec5 /**\cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u21462 \u24471 \u30070 \u21069 \u20998 \u38913 \u30340 \u20154 \u25976 \u32113 \u35336 \u65288 \u20998 \u38913 \u20154 \u25976 \u33287 \u38626 \u32887 \u20154 \u25976 \u65289 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  * \uc0\u9989  \u20462 \u27491 \u65306 \u21482 \u32113 \u35336 \u30070 \u21069 \u20998 \u38913 \u65292 \u32780 \u19981 \u26159 \u25152 \u26377 \u20489 \u21029 \cf4 \cb1 \strokec4 \
\cf5 \cb3 \strokec5  */\cf4 \cb1 \strokec4 \
\pard\pardeftab720\partightenfactor0
\cf6 \cb3 \strokec6 function\cf4 \strokec4  \cf9 \strokec9 getCurrentSheetPeopleCount\cf4 \strokec4 (\cf9 \strokec9 sheetName\cf4 \strokec4 , \cf9 \strokec9 spreadsheetId\cf4 \strokec4 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf4 \cb3   \cf6 \strokec6 try\cf4 \strokec4  \{\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 ss\cf4 \strokec4  = \cf7 \strokec7 SpreadsheetApp\cf4 \strokec4 .\cf9 \strokec9 openById\cf4 \strokec4 (\cf9 \strokec9 spreadsheetId\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 sh\cf4 \strokec4  = \cf9 \strokec9 ss\cf4 \strokec4 .\cf9 \strokec9 getSheetByName\cf4 \strokec4 (\cf9 \strokec9 sheetName\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 sh\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 total\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 leave\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 error\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u20998 \u38913 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastRow\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastRow\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 lastCol\cf4 \strokec4  = \cf9 \strokec9 sh\cf4 \strokec4 .\cf9 \strokec9 getLastColumn\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 lastRow\cf4 \strokec4  < \cf10 \strokec10 2\cf4 \strokec4  || \cf9 \strokec9 lastCol\cf4 \strokec4  < \cf10 \strokec10 1\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 total\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 leave\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf2 \strokec2 // \uc0\u35712 \u21462 \u36039 \u26009 \cf4 \cb1 \strokec4 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 data\cf4 \strokec4  = \cf9 \strokec9 readSheetToPayload_\cf4 \strokec4 (\cf9 \strokec9 sh\cf4 \strokec4 , \cf9 \strokec9 lastRow\cf4 \strokec4 , \cf9 \strokec9 lastCol\cf4 \strokec4 );\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 headers\cf4 \strokec4  = \cf9 \strokec9 data\cf4 \strokec4 .\cf9 \strokec9 headers\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 rows\cf4 \strokec4  = \cf9 \strokec9 data\cf4 \strokec4 .\cf9 \strokec9 rows\cf4 \strokec4 ;\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 nameCol\cf4 \strokec4  = \cf9 \strokec9 findNameCol_\cf4 \strokec4 (\cf9 \strokec9 headers\cf4 \strokec4 );\cb1 \
\
\cb3     \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 nameCol\cf4 \strokec4  < \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3       \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 total\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 leave\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 error\cf4 \strokec4 : \cf8 \strokec8 '\uc0\u25214 \u19981 \u21040 \u22995 \u21517 \u27396 \u20301 '\cf4 \strokec4  \};\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 peopleSet\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Set\cf4 \strokec4 ();\cb1 \
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 leaveSet\cf4 \strokec4  = \cf6 \strokec6 new\cf4 \strokec4  \cf7 \strokec7 Set\cf4 \strokec4 ();\cb1 \
\
\cb3     \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 i\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4  < \cf9 \strokec9 rows\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 i\cf4 \strokec4 ++) \{\cb1 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 name\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 nameCol\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (!\cf9 \strokec9 name\cf4 \strokec4 ) \cf6 \strokec6 continue\cf4 \strokec4 ;\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u9989  \u27298 \u26597 \u26159 \u21542 \u38626 \u32887 \u65306 \u27298 \u26597 \u35442 \u34892 \u25152 \u26377 \u27396 \u20301 \u26159 \u21542 \u21253 \u21547 \u12300 \u38626 \u12301 \u23383 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 isLeave\cf4 \strokec4  = \cf6 \strokec6 false\cf4 \strokec4 ;\cb1 \
\
\cb3       \cf2 \strokec2 // \uc0\u27298 \u26597 \u25152 \u26377 \u27396 \u20301 \cf4 \cb1 \strokec4 \
\cb3       \cf6 \strokec6 for\cf4 \strokec4  (\cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 col\cf4 \strokec4  = \cf10 \strokec10 0\cf4 \strokec4 ; \cf9 \strokec9 col\cf4 \strokec4  < \cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 .\cf9 \strokec9 length\cf4 \strokec4 ; \cf9 \strokec9 col\cf4 \strokec4 ++) \{\cb1 \
\cb3         \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 cellValue\cf4 \strokec4  = \cf7 \strokec7 String\cf4 \strokec4 (\cf9 \strokec9 rows\cf4 \strokec4 [\cf9 \strokec9 i\cf4 \strokec4 ].\cf9 \strokec9 v\cf4 \strokec4 [\cf9 \strokec9 col\cf4 \strokec4 ] || \cf8 \strokec8 ''\cf4 \strokec4 ).\cf9 \strokec9 trim\cf4 \strokec4 ();\cb1 \
\cb3         \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 cellValue\cf4 \strokec4 .\cf9 \strokec9 indexOf\cf4 \strokec4 (\cf8 \strokec8 '\uc0\u38626 '\cf4 \strokec4 ) >= \cf10 \strokec10 0\cf4 \strokec4 ) \{\cb1 \
\cb3           \cf9 \strokec9 isLeave\cf4 \strokec4  = \cf6 \strokec6 true\cf4 \strokec4 ;\cb1 \
\cb3           \cf6 \strokec6 break\cf4 \strokec4 ;\cb1 \
\cb3         \}\cb1 \
\cb3       \}\cb1 \
\
\cb3       \cf6 \strokec6 if\cf4 \strokec4  (\cf9 \strokec9 isLeave\cf4 \strokec4 ) \{\cb1 \
\cb3         \cf9 \strokec9 leaveSet\cf4 \strokec4 .\cf9 \strokec9 add\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3       \} \cf6 \strokec6 else\cf4 \strokec4  \{\cb1 \
\cb3         \cf9 \strokec9 peopleSet\cf4 \strokec4 .\cf9 \strokec9 add\cf4 \strokec4 (\cf9 \strokec9 name\cf4 \strokec4 );\cb1 \
\cb3       \}\cb1 \
\cb3     \}\cb1 \
\
\cb3     \cf6 \strokec6 var\cf4 \strokec4  \cf9 \strokec9 totalPeople\cf4 \strokec4  = \cf9 \strokec9 peopleSet\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4  + \cf9 \strokec9 leaveSet\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 ;\cb1 \
\
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{\cb1 \
\cb3       \cf9 \strokec9 total\cf4 \strokec4 : \cf9 \strokec9 totalPeople\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 leave\cf4 \strokec4 : \cf9 \strokec9 leaveSet\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 active\cf4 \strokec4 : \cf9 \strokec9 peopleSet\cf4 \strokec4 .\cf9 \strokec9 size\cf4 \strokec4 ,\cb1 \
\cb3       \cf9 \strokec9 success\cf4 \strokec4 : \cf6 \strokec6 true\cf4 \cb1 \strokec4 \
\cb3     \};\cb1 \
\
\cb3   \} \cf6 \strokec6 catch\cf4 \strokec4  (\cf9 \strokec9 e\cf4 \strokec4 ) \{\cb1 \
\cb3     \cf6 \strokec6 return\cf4 \strokec4  \{ \cf9 \strokec9 total\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 leave\cf4 \strokec4 : \cf10 \strokec10 0\cf4 \strokec4 , \cf9 \strokec9 error\cf4 \strokec4 : \cf9 \strokec9 e\cf4 \strokec4 .\cf9 \strokec9 toString\cf4 \strokec4 () \};\cb1 \
\cb3   \}\cb1 \
\cb3 \}\cb1 \
\
}